{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Wore Well e-commerce platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "name": {
          "type": "string",
          "description": "The full name of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The phone number of the user."
        },
        "gender": {
          "type": "string",
          "description": "The gender of the user (male, female, other, unisex)."
        },
        "address": {
          "type": "string",
          "description": "The address of the user."
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "phone",
        "gender",
        "address",
        "createdAt"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product available for sale on the Wore Well platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the product."
        },
        "image": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "rating": {
          "type": "number",
          "description": "The rating of the product (e.g., 4.5)."
        },
        "gender": {
          "type": "string",
          "description": "The target gender for the product (male, female, unisex)."
        },
        "price": {
          "type": "number",
          "description": "The price of the product in INR."
        },
        "stock": {
          "type": "number",
          "description": "The number of units currently in stock."
        },
        "sizes": {
          "type": "array",
          "description": "An array of available sizes for the product (XS, S, M, L, XL).",
          "items": {
            "type": "string"
          }
        },
        "tags": {
          "type": "array",
          "description": "An array of tags associated with the product (new, trending).",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time when the product was added to the catalog.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the product."
        }
      },
      "required": [
        "id",
        "name",
        "image",
        "rating",
        "gender",
        "price",
        "stock",
        "sizes",
        "tags",
        "createdAt",
        "description"
      ]
    },
    "Cart": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Cart",
      "type": "object",
      "description": "Represents the shopping cart for a user.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to User. The ID of the user who owns the cart. (Relationship: User 1:1 Cart)"
        },
        "items": {
          "type": "array",
          "description": "An array of items in the cart.",
          "items": {
            "type": "string"
          }
        },
        "updatedAt": {
          "type": "string",
          "description": "The date and time when the cart was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "userId",
        "items",
        "updatedAt"
      ]
    },
    "CartItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CartItem",
      "type": "object",
      "description": "Represents an item within a shopping cart.",
      "properties": {
        "productId": {
          "type": "string",
          "description": "Reference to Product. The ID of the product in the cart item. (Relationship: Product 1:N CartItem)"
        },
        "qty": {
          "type": "number",
          "description": "The quantity of the product in the cart item."
        },
        "size": {
          "type": "string",
          "description": "The selected size of the product in the cart item."
        }
      },
      "required": [
        "productId",
        "qty",
        "size"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents an order placed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. The ID of the user who placed the order. (Relationship: User 1:N Order)"
        },
        "items": {
          "type": "array",
          "description": "An array of items in the order.",
          "items": {
            "type": "string"
          }
        },
        "total": {
          "type": "number",
          "description": "The total amount of the order."
        },
        "address": {
          "type": "string",
          "description": "The shipping address for the order."
        },
        "status": {
          "type": "string",
          "description": "The status of the order (Placed, Shipped, Delivered)."
        },
        "deliveryDate": {
          "type": "string",
          "description": "The expected delivery date of the order.",
          "format": "date-time"
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time when the order was placed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "items",
        "total",
        "address",
        "status",
        "deliveryDate",
        "createdAt"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "productId": {
          "type": "string",
          "description": "Reference to Product. The ID of the product in the order item. (Relationship: Product 1:N OrderItem)"
        },
        "name": {
          "type": "string",
          "description": "The name of the product in the order item."
        },
        "price": {
          "type": "number",
          "description": "The price of the product in the order item."
        },
        "qty": {
          "type": "number",
          "description": "The quantity of the product in the order item."
        },
        "size": {
          "type": "string",
          "description": "The selected size of the product in the order item."
        }
      },
      "required": [
        "productId",
        "name",
        "price",
        "qty",
        "size"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. The userId parameter is the Firebase Authentication UID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (Firebase Authentication UID)."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product catalog information.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cart",
        "definition": {
          "entityName": "Cart",
          "schema": {
            "$ref": "#/backend/entities/Cart"
          },
          "description": "Stores the user's shopping cart data. The userId parameter is the Firebase Authentication UID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (Firebase Authentication UID)."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cart/{cartItemId}/items",
        "definition": {
          "entityName": "CartItem",
          "schema": {
            "$ref": "#/backend/entities/CartItem"
          },
          "description": "Stores cart items within the user's cart. The userId parameter is the Firebase Authentication UID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (Firebase Authentication UID)."
            },
            {
              "name": "cartItemId",
              "description": "The unique identifier for the cart item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores order information for a user. Includes denormalized 'userId' for authorization independence. The userId parameter is the Firebase Authentication UID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (Firebase Authentication UID)."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}/items/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores items within an order.  The userId parameter is the Firebase Authentication UID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (Firebase Authentication UID)."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "The unique identifier for the order item."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Wore Well e-commerce platform, emphasizing security, scalability, and ease of debugging.  The structure is built around the principles of Authorization Independence, Clarity of Intent, and Structural Segregation. Key aspects of the design include:\n\n1.  **Authorization Independence**:  Authorization is achieved without relying on hierarchical `get()` calls. For instance, user-owned data resides under `/users/{userId}`, eliminating the need to fetch parent document data for authorization.\n2.  **Clarity of Intent**: The structure is self-explanatory. User data, product data, and order data are stored in clearly named collections.\n3.  **DBAC (Database-Assisted Access Control)**:  Authorization rules rely solely on `request.auth.uid` and the data present in the documents. There is no use of custom claims.\n4.  **QAPs (Rules are not Filters)**: The data structure facilitates secure list operations.  For example, products intended for a specific gender are stored together, allowing filtering based on the `gender` field.\n5.  **Invariants**:  Ownership and timestamps are maintained for data integrity.  The `userId` in the `carts` and `orders` collections ensures clear ownership.\n\n**Denormalization Strategy (Authorization Independence):** The `Order` documents contain a `userId` field. This allows orders to be queried by `userId` without needing to perform a collection group query and filtering on the client.\n\n**Structural Segregation (Homogeneous Security Posture):** Data with different access requirements is stored in separate collections. User profiles are stored in the `/users` collection, while products are stored in the `/products` collection.\n\n**Access Modeling:**\n*   **Private Data:** User-specific data (carts, orders) resides under `/users/{userId}`, ensuring only the user can access it.\n*   **Collaborative Data:** Not applicable in this scenario.\n*   **Global Roles:** Not explicitly defined but can be added via a `/roles_admin/{uid}` collection if needed.\n\n**QAP Support:**\n*   Listing products for a specific gender is directly supported by storing `gender` in the `/products` collection.\n*   Order history is easily accessible under `/users/{userId}/orders`.\n\nThis structure ensures secure and efficient access to data while remaining scalable and easy to maintain."
  }
}